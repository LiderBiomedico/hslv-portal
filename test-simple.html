<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test Simple Netlify</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 2rem;
            background: #f8fafc;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            cursor: pointer;
            margin: 1rem 0;
            font-size: 1rem;
            width: 100%;
        }
        .btn:hover {
            background: #1d4ed8;
        }
        .result {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 0.875rem;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
        }
        .success {
            background: #f0fdf4;
            border-color: #22c55e;
            color: #15803d;
        }
        .error {
            background: #fef2f2;
            border-color: #ef4444;
            color: #dc2626;
        }
        .warning {
            background: #fffbeb;
            border-color: #f59e0b;
            color: #d97706;
        }
        h1 {
            color: #1f2937;
            text-align: center;
            margin-bottom: 2rem;
        }
        .status {
            text-align: center;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Simple de Netlify Functions</h1>
        
        <div class="status" id="site-status">
            <h3>üìä Informaci√≥n del Sitio</h3>
            <p><strong>URL:</strong> <span id="site-url"></span></p>
            <p><strong>Hostname:</strong> <span id="hostname"></span></p>
        </div>

        <button class="btn" onclick="testHelloFunction()">
            üéâ Test Funci√≥n Hello (B√°sica)
        </button>
        <div id="hello-result" class="result" style="display: none;"></div>

        <button class="btn" onclick="testConfigFunction()">
            üîß Test Funci√≥n Config  
        </button>
        <div id="config-result" class="result" style="display: none;"></div>

        <button class="btn" onclick="testAirtableProxy()">
            üì° Test Funci√≥n Airtable Proxy
        </button>
        <div id="proxy-result" class="result" style="display: none;"></div>

        <button class="btn" onclick="listAllFunctions()">
            üìã Probar Todas las Funciones Posibles
        </button>
        <div id="all-functions-result" class="result" style="display: none;"></div>
    </div>

    <script>
        // Informaci√≥n del sitio
        document.getElementById('site-url').textContent = window.location.href;
        document.getElementById('hostname').textContent = window.location.hostname;

        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = content;
            element.className = `result ${type}`;
        }

        async function testHelloFunction() {
            showResult('hello-result', 'üîÑ Probando funci√≥n hello b√°sica...', 'warning');
            
            try {
                const response = await fetch('/.netlify/functions/hello', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                console.log('Hello Response Status:', response.status);
                console.log('Hello Response Headers:', Object.fromEntries(response.headers.entries()));

                if (response.ok) {
                    const data = await response.json();
                    const output = `‚úÖ FUNCI√ìN HELLO EXITOSA

üìä STATUS: ${response.status} ${response.statusText}

üéâ MENSAJE: ${data.message}
‚è∞ TIMESTAMP: ${data.timestamp}
üîß METHOD: ${data.method}
üìÇ PATH: ${data.path}

üíª ENVIRONMENT:
‚Ä¢ Node Version: ${data.environment?.nodeVersion || 'N/A'}
‚Ä¢ Platform: ${data.environment?.platform || 'N/A'}
‚Ä¢ Has Airtable Key: ${data.environment?.hasAirtableKey ? '‚úÖ' : '‚ùå'}
‚Ä¢ Has Airtable Base: ${data.environment?.hasAirtableBase ? '‚úÖ' : '‚ùå'}

üåê NETLIFY INFO:
‚Ä¢ Function Name: ${data.netlifyInfo?.functionName || 'N/A'}
‚Ä¢ Function Version: ${data.netlifyInfo?.functionVersion || 'N/A'}
‚Ä¢ Region: ${data.netlifyInfo?.region || 'N/A'}

üìÑ RESPUESTA COMPLETA:
${JSON.stringify(data, null, 2)}`;

                    showResult('hello-result', output, 'success');
                } else {
                    const errorText = await response.text();
                    const output = `‚ùå ERROR EN FUNCI√ìN HELLO

üìä STATUS: ${response.status} ${response.statusText}

üìÑ RESPUESTA:
${errorText}

üîç DIAGN√ìSTICO:
‚Ä¢ Si ves "Page not found" ‚Üí Funci√≥n no desplegada
‚Ä¢ Si ves 403/401 ‚Üí Error de permisos
‚Ä¢ Si ves 500 ‚Üí Error interno de la funci√≥n`;

                    showResult('hello-result', output, 'error');
                }

            } catch (error) {
                const output = `üí• ERROR DE CONEXI√ìN

‚ùå Error: ${error.message}
üìö Stack: ${error.stack}

üîç POSIBLES CAUSAS:
‚Ä¢ Funci√≥n no desplegada
‚Ä¢ Error de red
‚Ä¢ Configuraci√≥n incorrecta`;

                showResult('hello-result', output, 'error');
            }
        }

        async function testConfigFunction() {
            showResult('config-result', 'üîÑ Probando funci√≥n test-config...', 'warning');
            
            try {
                const response = await fetch('/.netlify/functions/test-config');
                
                if (response.status === 404) {
                    showResult('config-result', '‚ùå FUNCI√ìN TEST-CONFIG NO ENCONTRADA (404)\n\nEsto significa que la funci√≥n no se despleg√≥ correctamente.', 'error');
                } else if (response.ok) {
                    const data = await response.json();
                    showResult('config-result', `‚úÖ FUNCI√ìN TEST-CONFIG FUNCIONANDO\n\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    const errorText = await response.text();
                    showResult('config-result', `‚ùå ERROR ${response.status}: ${errorText}`, 'error');
                }
            } catch (error) {
                showResult('config-result', `üí• ERROR: ${error.message}`, 'error');
            }
        }

        async function testAirtableProxy() {
            showResult('proxy-result', 'üîÑ Probando funci√≥n airtable-proxy...', 'warning');
            
            try {
                const response = await fetch('/.netlify/functions/airtable-proxy/Solicitudes?maxRecords=1');
                
                if (response.status === 404) {
                    showResult('proxy-result', '‚ùå FUNCI√ìN AIRTABLE-PROXY NO ENCONTRADA (404)\n\nEsto significa que la funci√≥n no se despleg√≥ correctamente.', 'error');
                } else if (response.ok) {
                    const data = await response.json();
                    showResult('proxy-result', `‚úÖ FUNCI√ìN AIRTABLE-PROXY FUNCIONANDO\n\nRecords: ${data.records?.length || 0}\n\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    const errorText = await response.text();
                    let parsedError;
                    try {
                        parsedError = JSON.parse(errorText);
                    } catch (e) {
                        parsedError = errorText;
                    }
                    showResult('proxy-result', `‚ùå ERROR ${response.status}: ${typeof parsedError === 'object' ? JSON.stringify(parsedError, null, 2) : parsedError}`, 'error');
                }
            } catch (error) {
                showResult('proxy-result', `üí• ERROR: ${error.message}`, 'error');
            }
        }

        async function listAllFunctions() {
            showResult('all-functions-result', 'üîÑ Probando todas las funciones posibles...', 'warning');
            
            const functionsToTest = [
                'hello',
                'test-config',
                'airtable-proxy',
                'simple-debug',
                'debug-airtable'
            ];

            let results = 'üìã RESULTADO DE TODAS LAS FUNCIONES:\n\n';
            let workingFunctions = 0;

            for (const func of functionsToTest) {
                try {
                    console.log(`Testing function: ${func}`);
                    
                    const response = await fetch(`/.netlify/functions/${func}`, {
                        method: 'GET'
                    });
                    
                    if (response.status === 404) {
                        results += `‚ùå ${func}: NO ENCONTRADA (404)\n`;
                    } else if (response.ok) {
                        results += `‚úÖ ${func}: FUNCIONANDO (${response.status})\n`;
                        workingFunctions++;
                    } else {
                        results += `‚ö†Ô∏è ${func}: ERROR ${response.status}\n`;
                        workingFunctions++;
                    }
                    
                } catch (error) {
                    results += `üí• ${func}: CONEXION ERROR (${error.message})\n`;
                }

                // Peque√±a pausa entre requests
                await new Promise(resolve => setTimeout(resolve, 200));
            }

            results += `\nüìä RESUMEN:\n`;
            results += `‚Ä¢ Total funciones probadas: ${functionsToTest.length}\n`;
            results += `‚Ä¢ Funciones desplegadas: ${workingFunctions}\n`;
            results += `‚Ä¢ Funciones faltantes: ${functionsToTest.length - workingFunctions}\n`;

            if (workingFunctions === 0) {
                results += `\nüö® PROBLEMA CR√çTICO:\n`;
                results += `‚Ä¢ NINGUNA funci√≥n se despleg√≥ correctamente\n`;
                results += `‚Ä¢ Verificar estructura de carpetas\n`;
                results += `‚Ä¢ Verificar package.json\n`;
                results += `‚Ä¢ Verificar logs de deploy en Netlify\n`;
            } else if (workingFunctions < functionsToTest.length) {
                results += `\n‚ö†Ô∏è PROBLEMA PARCIAL:\n`;
                results += `‚Ä¢ Algunas funciones no se desplegaron\n`;
                results += `‚Ä¢ Verificar errores espec√≠ficos\n`;
            } else {
                results += `\n‚úÖ TODO FUNCIONANDO:\n`;
                results += `‚Ä¢ Todas las funciones desplegadas correctamente\n`;
            }

            showResult('all-functions-result', results, workingFunctions > 0 ? 'success' : 'error');
        }

        // Auto-ejecutar test b√°sico al cargar
        window.addEventListener('load', function() {
            console.log('üß™ P√°gina de test simple cargada');
            console.log('üåê URL completa:', window.location.href);
            
            // Auto-ejecutar test b√°sico despu√©s de 2 segundos
            setTimeout(() => {
                console.log('üöÄ Ejecutando test autom√°tico...');
                testHelloFunction();
            }, 2000);
        });
    </script>
</body>
</html>