# ğŸ¥ Sistema de GestiÃ³n Hospital Susana LÃ³pez de Valencia

## ğŸ“‹ DescripciÃ³n General

Sistema completo de gestiÃ³n de solicitudes de mantenimiento con numeraciÃ³n automÃ¡tica, asignaciÃ³n inteligente de personal y tracking de tiempos de respuesta, desarrollado por **Ing. Paul Eduardo MuÃ±oz R.**

### ğŸš€ CaracterÃ­sticas Principales

- **ğŸ”¢ NumeraciÃ³n AutomÃ¡tica**: SOLBIO00001, SOLMEC00001, SOLINFRA00001
- **ğŸ¯ AsignaciÃ³n Inteligente**: Personal especializado por Ã¡rea tÃ©cnica
- **â±ï¸ Tracking de Tiempos**: MÃ©tricas de respuesta en tiempo real
- **ğŸŒ Sistema Cloud**: SincronizaciÃ³n automÃ¡tica con Airtable
- **ğŸ“± Multi-dispositivo**: Acceso desde cualquier computador
- **ğŸ” Control de Acceso**: CÃ³digos Ãºnicos de 4 dÃ­gitos

---

## ğŸ—ï¸ Arquitectura del Sistema

### Componentes Principales

```
ğŸ“ Sistema Hospital/
â”œâ”€â”€ ğŸŒ Portal de Solicitudes (portal-solicitudes.html)
â”œâ”€â”€ ğŸ‘¨â€ğŸ’¼ Portal de GestiÃ³n (portal-gestion.html)
â”œâ”€â”€ âš™ï¸ ConfiguraciÃ³n API (airtable-config.js)
â”œâ”€â”€ ğŸ§ª Sistema de Testing (test-sistema-completo.html)
â”œâ”€â”€ ğŸ›¡ï¸ Funciones Netlify/
â”‚   â”œâ”€â”€ airtable-proxy.js
â”‚   â”œâ”€â”€ user-management.js
â”‚   â”œâ”€â”€ hello.js
â”‚   â””â”€â”€ simple-debug.js
â””â”€â”€ ğŸ“‹ ConfiguraciÃ³n (netlify.toml)
```

### Base de Datos (Airtable)

**Tablas Configuradas:**
- `Solicitudes`: Requests de mantenimiento con numeraciÃ³n automÃ¡tica
- `Tecnicos`: Personal de soporte por Ã¡reas especializadas
- `Usuarios`: Control de acceso con cÃ³digos Ãºnicos
- `SolicitudesAcceso`: GestiÃ³n de nuevos usuarios

---

## ğŸ”¢ Sistema de NumeraciÃ³n AutomÃ¡tica

### Formatos por Ãrea

| Ãrea | Prefijo | Formato | Ejemplo |
|------|---------|---------|---------|
| **IngenierÃ­a BiomÃ©dica** | `SOLBIO` | SOLBIO00001 | SOLBIO00001 |
| **MecÃ¡nica** | `SOLMEC` | SOLMEC00001 | SOLMEC00001 |
| **Infraestructura** | `SOLINFRA` | SOLINFRA00001 | SOLINFRA00001 |

### CaracterÃ­sticas

- âœ… **Incremental AutomÃ¡tico**: NÃºmeros secuenciales Ãºnicos
- âœ… **PrevenciÃ³n de Duplicados**: ValidaciÃ³n en tiempo real
- âœ… **SincronizaciÃ³n Cloud**: Contadores sincronizados en Airtable
- âœ… **RecuperaciÃ³n AutomÃ¡tica**: AnÃ¡lisis de nÃºmeros existentes al iniciar

### CÃ³digo de ImplementaciÃ³n

```javascript
// Sistema de numeraciÃ³n en airtable-config.js
this.numerationSystem = {
    counters: {
        'INGENIERIA_BIOMEDICA': { prefix: 'SOLBIO', current: 0 },
        'MECANICA': { prefix: 'SOLMEC', current: 0 },
        'INFRAESTRUCTURA': { prefix: 'SOLINFRA', current: 0 }
    },
    
    generateNumber(area) {
        this.counters[area].current++;
        return `${this.counters[area].prefix}${String(this.counters[area].current).padStart(5, '0')}`;
    }
};
```

---

## ğŸ¯ Sistema de AsignaciÃ³n Inteligente

### Funcionalidades

#### ğŸ¤– Auto-AsignaciÃ³n
- **Por Ãrea**: AsignaciÃ³n automÃ¡tica segÃºn especializaciÃ³n
- **Por Prioridad**: Solicitudes crÃ­ticas tienen preferencia
- **Por Disponibilidad**: Solo personal disponible es asignado

#### ğŸ‘¨â€ğŸ”§ GestiÃ³n de Personal
- **Estados**: Disponible, Ocupado, Inactivo
- **EspecializaciÃ³n**: Por Ã¡rea tÃ©cnica
- **Carga de Trabajo**: Tracking de solicitudes asignadas

### Proceso de AsignaciÃ³n

```mermaid
graph TD
    A[Solicitud Creada] --> B[Verificar Ãrea]
    B --> C[Buscar Personal Disponible]
    C --> D{Â¿Personal Disponible?}
    D -->|SÃ­| E[Asignar Personal]
    D -->|No| F[Marcar Sin Personal]
    E --> G[Actualizar Estados]
    G --> H[Registrar Tiempos]
    H --> I[Notificar AsignaciÃ³n]
```

### CÃ³digo de AsignaciÃ³n

```javascript
async function asignarTecnicoASolicitud(solicitudId, tecnicoId) {
    // 1. Verificar disponibilidad
    const tecnico = await this.getTecnicos().find(t => t.id === tecnicoId);
    
    // 2. Actualizar solicitud
    await this.updateSolicitud(solicitudId, {
        tecnicoAsignado: tecnico.nombre,
        estado: 'ASIGNADA',
        fechaAsignacion: new Date().toISOString()
    });
    
    // 3. Actualizar tÃ©cnico
    await this.updateTecnico(tecnicoId, { 
        estado: 'ocupado',
        solicitudActual: solicitudId
    });
    
    return { success: true, tecnico, tiempos: ... };
}
```

---

## â±ï¸ Sistema de Tiempo de Respuesta

### MÃ©tricas Configuradas

| Prioridad | Tiempo LÃ­mite | Color | AcciÃ³n |
|-----------|---------------|-------|---------|
| **CRÃTICA** | 2 horas | ğŸ”´ Rojo | Alerta inmediata |
| **ALTA** | 4 horas | ğŸŸ¡ Amarillo | Seguimiento cercano |
| **MEDIA** | 24 horas | ğŸ”µ Azul | Seguimiento normal |
| **BAJA** | 72 horas | ğŸŸ¢ Verde | Seguimiento estÃ¡ndar |

### CÃ¡lculos AutomÃ¡ticos

```javascript
const timeTracker = {
    calcularTiempoRespuesta(fechaCreacion, fechaAsignacion) {
        const inicio = new Date(fechaCreacion);
        const fin = fechaAsignacion ? new Date(fechaAsignacion) : new Date();
        return fin - inicio;
    },
    
    evaluarTiempo(milliseconds, prioridad) {
        const limite = this.limitesTiempo[prioridad];
        if (milliseconds > limite) return { status: 'urgente', mensaje: 'Tiempo excedido' };
        if (milliseconds > limite * 0.8) return { status: 'normal', mensaje: 'PrÃ³ximo a vencer' };
        return { status: 'rapido', mensaje: 'Dentro del tiempo' };
    }
};
```

### EstadÃ­sticas Generadas

- âœ… **Tiempo Promedio** por Ã¡rea
- âœ… **Tiempo MÃ­nimo/MÃ¡ximo** histÃ³rico
- âœ… **Solicitudes Vencidas** contador
- âœ… **Eficiencia por TÃ©cnico** mÃ©tricas

---

## ğŸ” Sistema de Control de Acceso

### Proceso de Acceso

1. **ğŸ“ Solicitud**: Usuario completa formulario
2. **ğŸ‘¨â€ğŸ’¼ AprobaciÃ³n**: Admin revisa en Portal de GestiÃ³n
3. **ğŸ² GeneraciÃ³n**: CÃ³digo Ãºnico de 4 dÃ­gitos
4. **âœ… ActivaciÃ³n**: Usuario puede acceder al sistema

### CÃ³digos de Acceso

```javascript
async function generateUniqueAccessCode() {
    const usuarios = await this.getUsuarios();
    const existingCodes = usuarios.map(u => u.codigoAcceso).filter(Boolean);
    
    let code;
    do {
        code = Math.floor(1000 + Math.random() * 9000).toString();
    } while (existingCodes.includes(code));
    
    return code;
}
```

### ValidaciÃ³n de Acceso

```javascript
async function validateUserCredentials(email, codigoAcceso) {
    const user = await this.findUserByEmail(email);
    
    if (!user) return { valid: false, error: 'Usuario no encontrado' };
    if (user.estado !== 'ACTIVO') return { valid: false, error: 'Usuario inactivo' };
    if (user.codigoAcceso !== codigoAcceso) return { valid: false, error: 'CÃ³digo incorrecto' };
    
    return { valid: true, user };
}
```

---

## ğŸŒ ConfiguraciÃ³n de Airtable

### Variables de Entorno (Netlify)

```env
AIRTABLE_API_KEY=your_api_key_here
AIRTABLE_BASE_ID=your_base_id_here
```

### ConfiguraciÃ³n Local

```javascript
// En airtable-config.js para desarrollo local
this.baseUrl = 'https://api.airtable.com/v0/appFyEBCedQGOeJyV';
this.directApiKey = 'your_api_key_here';
```

### Estructura de Tablas

#### Tabla: Solicitudes
```javascript
{
    numero: 'SOLBIO00001',           // Generado automÃ¡ticamente
    servicioIngenieria: 'INGENIERIA_BIOMEDICA',
    tipoServicio: 'MANTENIMIENTO_CORRECTIVO',
    prioridad: 'CRITICA',
    equipo: 'Ventilador X',
    ubicacion: 'UCI 201',
    descripcion: 'DescripciÃ³n del problema',
    solicitante: 'Juan PÃ©rez',
    estado: 'PENDIENTE',
    tecnicoAsignado: 'Carlos LÃ³pez',
    fechaCreacion: '2025-01-20T10:00:00.000Z',
    fechaAsignacion: '2025-01-20T10:30:00.000Z'
}
```

#### Tabla: Tecnicos
```javascript
{
    nombre: 'Carlos LÃ³pez',
    email: 'carlos@hospital.com',
    area: 'INGENIERIA_BIOMEDICA',
    tipo: 'ingeniero',
    especialidad: 'Ventiladores',
    estado: 'disponible'
}
```

---

## ğŸš€ GuÃ­a de InstalaciÃ³n

### 1. ConfiguraciÃ³n de Airtable

1. **Crear Base en Airtable**
   - Ir a [airtable.com](https://airtable.com)
   - Crear nueva base: "Hospital Solicitudes"

2. **Crear Tablas**
   ```
   ğŸ“‹ Solicitudes
   ğŸ‘¥ Tecnicos
   ğŸ” Usuarios  
   ğŸ“ SolicitudesAcceso
   ```

3. **Obtener Credenciales**
   - API Key desde Account Settings
   - Base ID desde Help > API Documentation

### 2. ConfiguraciÃ³n de Netlify

1. **Deploy Files**
   ```bash
   # Subir archivos a Netlify
   - portal-solicitudes.html
   - portal-gestion.html
   - airtable-config.js
   - netlify.toml
   - netlify/functions/
   ```

2. **Variables de Entorno**
   ```
   Site Settings > Environment Variables:
   AIRTABLE_API_KEY = tu_api_key
   AIRTABLE_BASE_ID = tu_base_id
   ```

### 3. ConfiguraciÃ³n Local (Desarrollo)

1. **Actualizar airtable-config.js**
   ```javascript
   this.directApiKey = 'tu_api_key_aquÃ­';
   // En la lÃ­nea correspondiente
   ```

2. **Servidor Local**
   ```bash
   # Usar Live Server o similar
   npx http-server .
   ```

---

## ğŸ“± GuÃ­a de Uso

### Para Usuarios (Portal de Solicitudes)

1. **ğŸ“ Crear Solicitud**
   - Acceder con email + cÃ³digo de 4 dÃ­gitos
   - Seleccionar Ã¡rea tÃ©cnica
   - Completar formulario
   - âœ… NÃºmero automÃ¡tico generado

2. **ğŸ“‹ Seguimiento**
   - Ver solicitudes en "Mis Solicitudes"
   - Estado en tiempo real
   - TÃ©cnico asignado
   - Tiempo de respuesta

### Para Administradores (Portal de GestiÃ³n)

1. **ğŸ‘¨â€ğŸ’¼ GestiÃ³n de Solicitudes**
   - Dashboard con mÃ©tricas
   - Filtros avanzados
   - AsignaciÃ³n manual/automÃ¡tica
   - Seguimiento de tiempos

2. **ğŸ‘¥ GestiÃ³n de Personal**
   - Registro de tÃ©cnicos
   - Estados: disponible/ocupado/inactivo
   - Carga de trabajo
   - EspecializaciÃ³n por Ã¡rea

3. **ğŸ” Control de Acceso**
   - Aprobar solicitudes de acceso
   - Generar cÃ³digos Ãºnicos
   - GestiÃ³n de usuarios

---

## ğŸ§ª Testing del Sistema

### Test AutomÃ¡tico

Acceder a `test-sistema-completo.html` para:

- âœ… **Test de ConexiÃ³n**: Verificar Airtable
- âœ… **Test de NumeraciÃ³n**: Validar generaciÃ³n automÃ¡tica
- âœ… **Test de AsignaciÃ³n**: Verificar algoritmos
- âœ… **Test de Tiempos**: Validar cÃ¡lculos
- âœ… **Test Integral**: Flujo completo end-to-end

### Comandos de Debugging

```javascript
// En consola del navegador
debugAirtableConnection();           // Estado general
window.airtableAPI.getStatus();      // Estado detallado
window.airtableAPI.numerationSystem; // Info numeraciÃ³n
```

---

## ğŸ“Š MÃ©tricas y Reportes

### Dashboard AutomÃ¡tico

- **ğŸ“ˆ Total Solicitudes** por Ã¡rea
- **â±ï¸ Tiempos Promedio** de respuesta
- **ğŸ‘¥ Personal Disponible** por especializaciÃ³n
- **ğŸ”´ Solicitudes Vencidas** alertas

### ExportaciÃ³n de Datos

```javascript
// Generar reporte de tiempos
async function exportarReporteTiempos() {
    const stats = timeTracker.generarEstadisticas(solicitudes);
    // Copiar al portapapeles o descargar
}
```

---

## ğŸ”§ PersonalizaciÃ³n

### Agregar Nueva Ãrea

1. **Actualizar numeraciÃ³n**
   ```javascript
   // En airtable-config.js
   this.numerationSystem.counters['NUEVA_AREA'] = { 
       prefix: 'SOLNUEVA', 
       current: 0 
   };
   ```

2. **Actualizar mapeos**
   ```javascript
   const areas = {
       'NUEVA_AREA': 'Nueva Ãrea TÃ©cnica'
   };
   ```

### Modificar Tiempos LÃ­mite

```javascript
// En airtable-config.js
this.timeTracker.limitesTiempo = {
    'CRITICA': 1 * 60 * 60 * 1000,  // 1 hora
    'ALTA': 2 * 60 * 60 * 1000,     // 2 horas
    // ... personalizar segÃºn necesidades
};
```

---

## ğŸ› ï¸ SoluciÃ³n de Problemas

### Problemas Comunes

#### âŒ Error de ConexiÃ³n Airtable
```
Verificar:
1. API Key correcta
2. Base ID correcto
3. Permisos de la API Key
4. Variables de entorno en Netlify
```

#### âŒ NumeraciÃ³n No Funciona
```
Verificar:
1. ConexiÃ³n a Airtable activa
2. Tabla 'Solicitudes' existe
3. Campo 'servicioIngenieria' presente
4. Contadores inicializados
```

#### âŒ AsignaciÃ³n Falla
```
Verificar:
1. Personal registrado en Ã¡rea correcta
2. Estado 'disponible' del tÃ©cnico
3. Tabla 'Tecnicos' configurada
4. Campos 'area' y 'estado' presentes
```

### Logs de Debug

```javascript
// Habilitar logs detallados
console.log('ğŸ” Estado sistema:', window.airtableAPI.getStatus());
console.log('ğŸ”¢ Contadores:', window.airtableAPI.numerationSystem.counters);
console.log('ğŸ‘¥ Personal:', await window.airtableAPI.getTecnicos());
```

---

## ğŸ”’ Seguridad

### Mejores PrÃ¡cticas

- âœ… **API Keys**: Nunca exponer en cÃ³digo cliente
- âœ… **Proxy Netlify**: Oculta credenciales en producciÃ³n
- âœ… **CÃ³digos Ãšnicos**: 4 dÃ­gitos Ãºnicos por usuario
- âœ… **ValidaciÃ³n**: Server-side en funciones Netlify
- âœ… **CORS**: Configurado correctamente

### Variables Sensibles

```javascript
// âŒ NO hacer en producciÃ³n
const API_KEY = 'patXXXXXX...'; 

// âœ… Usar variables de entorno
const API_KEY = process.env.AIRTABLE_API_KEY;
```

---

## ğŸ“ Soporte

### Desarrollador

**ğŸ‘¨â€ğŸ’» Ing. Paul Eduardo MuÃ±oz R.**
- ğŸ¥ Hospital Susana LÃ³pez de Valencia E.S.E.
- ğŸ“§ Contacto disponible a travÃ©s del hospital

### DocumentaciÃ³n TÃ©cnica

- ğŸ“‹ **Airtable API**: [airtable.com/api](https://airtable.com/api)
- ğŸŒ **Netlify Functions**: [docs.netlify.com](https://docs.netlify.com)
- âš¡ **JavaScript ES6+**: [developer.mozilla.org](https://developer.mozilla.org)

---

## ğŸ“ˆ Roadmap Futuro

### Mejoras Planificadas

- ğŸ“± **App MÃ³vil**: React Native o PWA
- ğŸ“§ **Notificaciones**: Email automÃ¡tico
- ğŸ“Š **Dashboard Avanzado**: Charts y mÃ©tricas
- ğŸ”„ **IntegraciÃ³n WhatsApp**: Notificaciones
- ğŸ“‹ **Reportes PDF**: GeneraciÃ³n automÃ¡tica
- ğŸ¯ **IA Predictiva**: AsignaciÃ³n inteligente
- ğŸ“¦ **Inventario**: GestiÃ³n de repuestos

### VersiÃ³n Actual: v4.0

- âœ… Sistema de numeraciÃ³n automÃ¡tica
- âœ… AsignaciÃ³n inteligente de personal  
- âœ… Tracking completo de tiempos
- âœ… Portal dual (Solicitudes + GestiÃ³n)
- âœ… IntegraciÃ³n completa con Airtable
- âœ… Sistema de testing automatizado

---

## ğŸ“„ Licencia

Sistema desarrollado exclusivamente para **Hospital Susana LÃ³pez de Valencia E.S.E.** por **Ing. Paul Eduardo MuÃ±oz R.**

**Restricciones:**
- âœ… Uso interno del hospital
- âŒ DistribuciÃ³n externa sin autorizaciÃ³n
- âœ… Modificaciones permitidas para mejoras
- âŒ Uso comercial por terceros

---

## ğŸ™ Agradecimientos

- ğŸ¥ **Hospital Susana LÃ³pez de Valencia E.S.E.** - Por la oportunidad
- ğŸ‘¨â€âš•ï¸ **Personal MÃ©dico y TÃ©cnico** - Por los requerimientos
- ğŸ› ï¸ **Equipo de IngenierÃ­a** - Por las pruebas y feedback
- ğŸ’¡ **Usuarios Finales** - Por la retroalimentaciÃ³n continua

---

*Desarrollado con â¤ï¸ para mejorar la eficiencia del mantenimiento hospitalario*

**Â© 2025 - Ing. Paul Eduardo MuÃ±oz R. - Hospital Susana LÃ³pez de Valencia E.S.E.**