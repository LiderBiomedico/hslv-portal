# ğŸ¥ Portal de Solicitudes Cloud - Hospital Susana LÃ³pez de Valencia

Sistema completo de gestiÃ³n de solicitudes de mantenimiento con autenticaciÃ³n de usuarios y gestiÃ³n de accesos, desarrollado por **Ing. Paul Eduardo MuÃ±oz R.**

## ğŸŒŸ CaracterÃ­sticas Principales

### âœ… **SISTEMA COMPLETAMENTE FUNCIONAL**
- **Portal de Solicitudes**: Usuarios pueden crear solicitudes de mantenimiento
- **Portal de GestiÃ³n**: Administradores pueden gestionar solicitudes, usuarios y accesos
- **Sistema de AutenticaciÃ³n**: Login con email + cÃ³digo de 4 dÃ­gitos
- **GestiÃ³n de Accesos**: AprobaciÃ³n de solicitudes y generaciÃ³n automÃ¡tica de cÃ³digos
- **SincronizaciÃ³n Cloud**: Datos guardados en Airtable en tiempo real
- **Modo Fallback**: Funciona localmente si no hay conexiÃ³n

## ğŸ“‹ Estructura del Proyecto

```
â”œâ”€â”€ portal-solicitudes.html          # Portal para usuarios finales
â”œâ”€â”€ portal-gestion.html              # Portal para administradores
â”œâ”€â”€ airtable-config.js               # ConfiguraciÃ³n y API de Airtable
â”œâ”€â”€ test-completo.html               # Sistema de pruebas completo
â”œâ”€â”€ netlify.toml                     # ConfiguraciÃ³n de Netlify
â”œâ”€â”€ netlify/functions/
â”‚   â”œâ”€â”€ airtable-proxy.js           # Proxy principal para Airtable
â”‚   â”œâ”€â”€ user-management.js          # GestiÃ³n especÃ­fica de usuarios
â”‚   â”œâ”€â”€ hello.js                    # FunciÃ³n de prueba bÃ¡sica
â”‚   â”œâ”€â”€ test-config.js              # Test de configuraciÃ³n
â”‚   â”œâ”€â”€ simple-debug.js             # Debug de conexiÃ³n
â”‚   â””â”€â”€ inspect-table.js            # InspecciÃ³n de tablas
â””â”€â”€ README.md                       # Esta documentaciÃ³n
```

## ğŸš€ InstalaciÃ³n y ConfiguraciÃ³n

### 1. **Variables de Entorno en Netlify**

Configurar las siguientes variables en el panel de Netlify:

```bash
AIRTABLE_API_KEY=patXXXXXXXXXXXXXXXX
AIRTABLE_BASE_ID=appXXXXXXXXXXXXXX
```

### 2. **Estructura de Tablas en Airtable**

Crear las siguientes tablas en Airtable:

#### **Tabla: Solicitudes**
```
- numero (Single line text)
- servicioIngenieria (Single select)
- tipoServicio (Single select)
- prioridad (Single select)
- equipo (Single line text)
- ubicacion (Single line text)
- descripcion (Long text)
- observaciones (Long text)
- solicitante (Single line text)
- servicioHospitalario (Single select)
- emailSolicitante (Email)
- fechaCreacion (Date)
- estado (Single select)
- tecnicoAsignado (Single line text)
```

#### **Tabla: Usuarios**
```
- nombreCompleto (Single line text)
- email (Email)
- telefono (Phone number)
- servicioHospitalario (Single select)
- cargo (Single select)
- codigoAcceso (Single line text)
- estado (Single select: ACTIVO, INACTIVO)
- fechaCreacion (Date)
- fechaUltimoAcceso (Date)
- solicitudOrigenId (Single line text)
```

#### **Tabla: SolicitudesAcceso**
```
- id (Single line text)
- nombreCompleto (Single line text)
- email (Email)
- telefono (Phone number)
- servicioHospitalario (Single select)
- cargo (Single select)
- justificacion (Long text)
- fechaSolicitud (Date)
- estado (Single select: PENDIENTE, APROBADA, RECHAZADA)
- esUrgente (Checkbox)
- fechaAprobacion (Date)
- motivoRechazo (Long text)
- usuarioCreado (Single line text)
```

#### **Tabla: Tecnicos**
```
- nombre (Single line text)
- email (Email)
- area (Single select)
- tipo (Single select)
- especialidad (Single line text)
- estado (Single select)
```

### 3. **Despliegue en Netlify**

1. Conectar repositorio con Netlify
2. Configurar variables de entorno
3. Deploy automÃ¡tico activado

## ğŸ¯ Flujo de Uso del Sistema

### **Para Usuarios Finales:**

1. **Solicitar Acceso** (portal-solicitudes.html)
   - Ir a la pestaÃ±a "Solicitar Acceso"
   - Llenar formulario con datos personales
   - Solicitud se envÃ­a automÃ¡ticamente a Airtable
   - Esperar aprobaciÃ³n del administrador

2. **Iniciar SesiÃ³n** (portal-solicitudes.html)
   - Usar email registrado
   - Ingresar cÃ³digo de 4 dÃ­gitos (recibido tras aprobaciÃ³n)
   - Acceso al portal de solicitudes

3. **Crear Solicitudes** (portal-solicitudes.html)
   - Seleccionar Ã¡rea de ingenierÃ­a
   - Completar detalles del equipo y problema
   - Enviar solicitud (se guarda en Airtable automÃ¡ticamente)

### **Para Administradores:**

1. **Acceder al Portal de GestiÃ³n** (portal-gestion.html)
   - No requiere autenticaciÃ³n (versiÃ³n admin)
   - Dashboard con estadÃ­sticas en tiempo real

2. **Gestionar Solicitudes de Acceso**
   - Ver solicitudes pendientes en tiempo real
   - Aprobar/Rechazar con un click
   - GeneraciÃ³n automÃ¡tica de cÃ³digos Ãºnicos

3. **Gestionar Usuarios**
   - Ver usuarios activos
   - Regenerar cÃ³digos si es necesario
   - Desactivar/Activar usuarios

4. **Gestionar Solicitudes de Mantenimiento**
   - Ver todas las solicitudes
   - Asignar tÃ©cnicos
   - Actualizar estados

## ğŸ”§ Funcionalidades Principales

### **ğŸ” Sistema de AutenticaciÃ³n**
- **Email + CÃ³digo de 4 dÃ­gitos**
- **ValidaciÃ³n en tiempo real con Airtable**
- **CÃ³digos Ãºnicos autogenerados**
- **Control de estados de usuario (ACTIVO/INACTIVO)**

### **ğŸ“ GestiÃ³n de Solicitudes**
- **CreaciÃ³n en tiempo real**
- **SincronizaciÃ³n automÃ¡tica con Airtable**
- **Estados: PENDIENTE, ASIGNADA, EN_PROCESO, COMPLETADA**
- **Filtros por Ã¡rea, estado y prioridad**

### **ğŸ‘¥ GestiÃ³n de Accesos**
- **Flujo completo: Solicitud â†’ AprobaciÃ³n â†’ Usuario**
- **GeneraciÃ³n automÃ¡tica de cÃ³digos Ãºnicos**
- **ValidaciÃ³n de credenciales**
- **EstadÃ­sticas en tiempo real**

### **ğŸŒ Sistema Cloud**
- **Datos en Airtable en tiempo real**
- **Acceso desde cualquier dispositivo**
- **Respaldo automÃ¡tico**
- **Modo offline como fallback**

## ğŸ§ª Testing del Sistema

### **Usar test-completo.html**

Archivo completo de pruebas que incluye:

```bash
# Tests de ConexiÃ³n
- ConexiÃ³n bÃ¡sica con Airtable
- Test de todas las tablas
- VerificaciÃ³n de funciones Netlify

# Tests de Datos
- CreaciÃ³n y lectura de solicitudes
- GestiÃ³n completa de usuarios
- Solicitudes de acceso

# Tests de Flujo Completo
- Flujo de aprobaciÃ³n completo
- ValidaciÃ³n de acceso
- GeneraciÃ³n de cÃ³digos Ãºnicos

# EstadÃ­sticas del Sistema
- Contadores en tiempo real
- Estado de todas las tablas
```

### **Funciones de Debug Disponibles**

```javascript
// En la consola del navegador:

// DiagnÃ³stico completo
debugAirtableConnection()

// Test especÃ­fico de usuarios
await testUserManagement()

// Ver estado del sistema
window.airtableAPI.getStatus()

// Test de validaciÃ³n
await window.airtableAPI.validateUserCredentials('email@test.com', '1234')
```

## ğŸ“Š APIs y Endpoints

### **Funciones Netlify Disponibles:**

```bash
# Proxy principal
/.netlify/functions/airtable-proxy/{tabla}

# GestiÃ³n de usuarios
/.netlify/functions/user-management?operation={operacion}

# Funciones de debug
/.netlify/functions/simple-debug
/.netlify/functions/test-config
/.netlify/functions/hello
```

### **Operaciones de GestiÃ³n de Usuarios:**

```javascript
// Listar usuarios
GET /.netlify/functions/user-management?operation=list

// Crear usuario
POST /.netlify/functions/user-management?operation=create

// Actualizar usuario
PATCH /.netlify/functions/user-management?operation=update&id={userId}

// Validar acceso
POST /.netlify/functions/user-management?operation=validate

// Aprobar solicitud
POST /.netlify/functions/user-management?operation=approve-request&requestId={id}

// EstadÃ­sticas
GET /.netlify/functions/user-management?operation=statistics
```

## ğŸ”’ Seguridad

### **ConfiguraciÃ³n Segura:**
- **Variables de entorno en Netlify** (no en cÃ³digo)
- **Proxy para ocultar API keys**
- **ValidaciÃ³n de datos en cliente y servidor**
- **CÃ³digos Ãºnicos autogenerados**

### **Fallbacks de Seguridad:**
- **Modo local si falla conexiÃ³n**
- **ValidaciÃ³n doble de credenciales**
- **Control de estados de usuario**

## ğŸ¨ Interfaz de Usuario

### **DiseÃ±o Moderno y Responsivo:**
- **CSS Grid y Flexbox**
- **Gradientes y animaciones**
- **Indicadores de estado en tiempo real**
- **Modo oscuro para logs**
- **Compatibilidad mÃ³vil**

### **Experiencia de Usuario:**
- **Feedback visual instantÃ¡neo**
- **Mensajes claros de estado**
- **NavegaciÃ³n intuitiva**
- **Loading states y animaciones**

## ğŸ”„ Flujo TÃ©cnico Completo

### **1. Solicitud de Acceso:**
```
Usuario â†’ Portal Solicitudes â†’ Airtable (SolicitudesAcceso)
â†’ Portal GestiÃ³n â†’ AprobaciÃ³n â†’ Airtable (Usuarios)
â†’ CÃ³digo generado â†’ Usuario puede acceder
```

### **2. CreaciÃ³n de Solicitud:**
```
Usuario autenticado â†’ Portal Solicitudes 
â†’ Airtable (Solicitudes) â†’ Portal GestiÃ³n
â†’ AsignaciÃ³n tÃ©cnico â†’ Seguimiento
```

### **3. SincronizaciÃ³n:**
```
Cliente â†” Netlify Functions â†” Airtable
Fallback: Cliente â†” localStorage
```

## ğŸ“ˆ EstadÃ­sticas y MÃ©tricas

El sistema incluye mÃ©tricas en tiempo real:

- **Total de solicitudes por Ã¡rea**
- **Usuarios activos vs inactivos**
- **Solicitudes de acceso pendientes**
- **Personal tÃ©cnico disponible**
- **Estados de solicitudes**

## ğŸ› ï¸ Desarrollo y Mantenimiento

### **Estructura del CÃ³digo:**
- **SeparaciÃ³n clara de responsabilidades**
- **ConfiguraciÃ³n centralizada en airtable-config.js**
- **Funciones Netlify modulares**
- **Sistema de logging completo**

### **Para Desarrolladores:**
```javascript
// Extender funcionalidad
class AirtableAPI {
  // Agregar nuevos mÃ©todos aquÃ­
  async nuevoMetodo() { ... }
}

// Agregar nuevas validaciones
function validarNuevosCampos() { ... }

// Crear nuevas funciones Netlify
exports.handler = async (event, context) => { ... }
```

## ğŸ“ Soporte y Contacto

**Desarrollado por:** Ing. Paul Eduardo MuÃ±oz R.
**Hospital:** Susana LÃ³pez de Valencia E.S.E.
**UbicaciÃ³n:** PopayÃ¡n, Cauca, Colombia

---

## ğŸ‰ Â¡Sistema Completamente Funcional!

El portal estÃ¡ listo para uso en producciÃ³n con:

âœ… **AutenticaciÃ³n completa**
âœ… **GestiÃ³n de usuarios y accesos**  
âœ… **SincronizaciÃ³n con Airtable**
âœ… **Interfaz moderna y responsiva**
âœ… **Sistema de pruebas completo**
âœ… **DocumentaciÃ³n completa**

Para cualquier consulta o soporte tÃ©cnico, contactar al desarrollador del sistema.